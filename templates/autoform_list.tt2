<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="/jscript/jquery.poshytip.min.js"></script>
<link href="/css/tip-redsimple.css" rel="stylesheet" type="text/css">
<link href="/css/autoform.css" rel="stylesheet" type="text/css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<font face="arial">

<center>
<div id = "app_list_div">

<form action = "[% addr %]?t=[% token %][% IF lang_in_link %]&lang=[% lang_in_link %][% END %]" method = "POST" name = "dataform">
<input type = "hidden" value = "nothing" name = "action" id = "action">
<input type = "hidden" value = "" name = "person" id = "person">
<input type = "hidden" value = "[% mobile_app %]" name = "mobile_app" id = "mobile_app">

<table id="app_list" width="100%">

<tr class="mobil_hide"><td><table id="progressbar" class="progressbar_gen"><tr>[% progress %]<tr></table><br><br><br></td></tr>

<tr><td align="center">
<table width="600px" id="app_table">

<tr><td colspan="5"><h2>[% langreq(title) %]</h2><br></td></tr>

[% IF content_text.0.ID == "X" %]
	<tr><td colspan="5" id = "applist">
	[% langreq('Вы ещё не зарегистрировали ни одного заявителя в данной записи') %].<br>
	[% langreq('Сделайте это прямо сейчас, нажав на кнопку <b>"Зарегистрировать заявителя"</b>') %]!<br>
	[% langreq('После заполнения данных первого заявителя, Вы сможете добавить последующих') %].<br><br>
	</td></tr>
[% ELSE %]
	[% SET i = 0 %][% FOREACH person IN content_text %][% SET i = i + 1 %]
	<tr>
	<td>[% i %].</td>
	<td [% IF i == 1 %]id = "applist"[% END %] width="90%">
	[% IF person.Finished == 0 %]<b>[[% langreq('черновик') %]]</b>
	[% ELSIF person.Finished == 2 %]<b>[[% langreq('тип визы') %]]</b>
	[% ELSIF person.Finished == 3 %]<b>[[% langreq('в.центр') %]]</b>
	[% END %]
	[% IF (person.FName != '') || (person.LName != '') %]
	[% person.FName %] [% person.LName %]
	[% ELSE %]
	([% langreq('ФИО пока не указано') %])
	[% END %]</td>
	<td>[% IF person.BirthDate != '00.00.0000' %][% person.BirthDate %][% ELSE %]&nbsp;[% END %]</td>
	<td><input class="edit_input small_button" type="button" value="[% langreq('Редактировать') %]" onclick="edit_button([% person.ID %]);"></td>
	<td><input class="small_button" type="button" value="X" onclick="delapp_button([% person.ID %]);"></td>
	</tr>
	[% END %]
[% END %]

[% IF i < max_applicants %]
<tr><td colspan="5">
	<span id="spacer"></span>
	<input class="action_button" type="button" value="[% langreq('Зарегистрировать заявителя') %]" onclick="go_button('addapp');">
</td></tr>
[% END %]

[% IF content_text.0.ID == "X" %]
	<tr><td colspan="5"><br>
	[% langreq('На указанную вами электронную почту отправлено письмо со ссылкой, перейдя по которой, вы сможете в любой момент продолжить регистрацию данной записи. Если вы не получили его в течение часа, проверьте папку нежелательные сообщения (спам)') %].<br>
	</td></tr>
[% END %]

<tr><td colspan="5">&nbsp;
</td></tr>

<tr><td colspan="5">
	<input class="action_button" type="button" value="&#9665; [% langreq('Назад') %]" onclick="go_button('back');">
	&nbsp;
	<input class="action_button" type="button" value="[% langreq('Оформить запись') %] &#9655;" onclick="go_button('tofinish');">
	
</td></tr>
<tr><td colspan="5">&nbsp;</td></tr>
</table>

</td></tr></table>

</form>

<script>

[% IF last_error_name %]
	$('#[% last_error_name %]').poshytip({
		className: 'tip-redsimple',
		content: '[% langreq(last_error_text) %]',
		showOn: 'none',
		alignTo: 'target',
		alignX: 'inner-left',
		offsetX: 0,
		offsetY: 5
	});
[% END %]

function edit_button(id) {
	$('#action').val('edit');
	$('#person').val(id);
	document.dataform.submit();
};

function delapp_button(id) {
	if ( confirm("[% langreq("Вы уверены, что хотите удалить заявителя из записи?") %]") ) {
		$('#action').val('delapp');
		$('#person').val(id);
		document.dataform.submit();
	}
};

function go_button(where) {
	$('#action').val(where);
	document.dataform.submit();
};

$(document).ready(mobileScreenCheck);

function isMobile() {
	return (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
}

function mobileScreenCheck() {

	var mobilScreen = isMobile();

	$('#progressbar').css( "display", ( mobilScreen ? 'none' : 'table' ) );
	$('#app_table').attr( "width", ( mobilScreen ? '100%' : '600px' ) );
	$('#app_list_div').css( "margin", ( mobilScreen ? '0px' : '50px' ) );
	$('.edit_input').attr( "value", ( mobilScreen ? "\u270E" : '[% langreq('Редактировать') %]' ) );
	
	[% IF last_error_name %]
		$('#[% last_error_name %]').poshytip('hide');
		$('#[% last_error_name %]').poshytip('show');
	[% END %]
	
	if ( !mobilScreen ) { return; }

	$('#app_table').attr( "cellspacing", '10' );
	$('.action_button').css( "height", '60px' );
	$('.action_button').css( "width", '100%' );
	$('.small_button').css( "height", '30px' );
	$('.small_button').css( "width", '30px' );
	$('#spacer').html( '<br>' );

	$('.mobil_hide').css( "display", 'none' );

	$('*').css( "font-size", '15px' );
	
	$('h2').css( "font-size", '20px' );
	$('h2, .bold_text').css( "color", '#FF6666' );
}

</script>

</div>
